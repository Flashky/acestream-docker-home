<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Ace Link</title>
    <link rel="icon" type="image/x-icon"
          href="https://lh3.googleusercontent.com/drive-viewer/AKGpihZoBOT8YvVO8u53lht7oeVVmko0q4EqDT5mVGHpurxXNl9vIrM96zStqLVdIaXWm8n6PSrkRwIAzHnUJKhrkDdwMSNMHX0IYkU=w1314-h1045">
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet"/>
    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet"/>
    <style>
        body, html, video, .video-js {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
        }

        .video-js .vjs-big-play-button {
            top: 45%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #acestream-link-input {
            display: flex;
            align-items: center;
            gap: 10px;
            position: absolute;
            top: 10px;
            left: 40px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.7);
            padding: 5px;
            border-radius: 5px;
        }

        #acestream-link {
            border: 1px solid #ccc;
            border-radius: 3px;
            padding: 5px 10px;
        }

        #acestream-link-input button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            margin-left: 5px;
            cursor: pointer;
            border-radius: 3px;
        }

        #acestream-link-input button:hover {
            background-color: #0056b3;
        }

        #toggle-view {
            position: absolute;
            top: 15px;
            left: 5px;
            z-index: 101;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.7);
            padding: 5px;
            border-radius: 50%;
        }
    </style>
</head>
<body>
<div id="toggle-view">
    <i class="fas fa-eye" id="toggle-icon"></i>
</div>
<div id="acestream-link-input">
    <input type="text" id="acestream-link" placeholder="Insertar aquí el enlace Acestream"/>
    <button onclick="loadAceStream()">Cargar</button>
</div>
<video
        id="video"
        class="video-js vjs-default-skin"
        controls
        preload="auto"
        data-setup="{}"
        width="100%"
        height="100%">
    <p class="vjs-no-js">
        To view this video please enable JavaScript, and consider upgrading to a web browser that
        <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
    </p>
</video>
<script>
    // En la primera carga, cargamos desde el enlace si viene el parámetro
    // Obtener el playerId de la variable externa
    let playerId = "{player_id}";

    document.title = `${document.title} [${playerId.substr(0, 7)}]`;
    let player = videojs('video');
    player.src({
        src: `http://127.0.0.1:6878/ace/manifest.m3u8?id=${playerId}`,
        type: 'application/x-mpegURL' // Ajuste para el tipo MIME correcto para streams HLS.
    });
    player.play();

    function loadAceStream() {
        let acestreamLink = document.getElementById('acestream-link').value;
        // Elimina el prefijo 'acestream://' si está presente
        acestreamLink = acestreamLink.replace('acestream://', '');
        // Comprueba si el ID tiene más de 1 caracter
        if (acestreamLink.length > 1) {
            const playerId = acestreamLink;
            document.title = `Ace Link [${playerId.substr(0, 7)}]`;
            player.src({
                src: `http://127.0.0.1:6878/ace/manifest.m3u8?id=${playerId}`,
                type: 'application/x-mpegURL'
            });
            player.play();
        } else {
            alert('Por favor, inserta un enlace Acestream válido.');
        }
    }

    // Funcionalidad para mostrar/ocultar el input y ajustar el icono de toggle
    document.getElementById('toggle-view').addEventListener('click', function () {
        let inputDiv = document.getElementById('acestream-link-input');
        let icon = document.getElementById('toggle-icon');
        if (inputDiv.style.display === "none") {
            inputDiv.style.display = "flex";
            icon.className = "fas fa-eye-slash"; // Cambiar a icono de ojo cerrado
        } else {
            inputDiv.style.display = "none";
            icon.className = "fas fa-eye"; // Cambiar a icono de ojo abierto
        }
    });
</script>
</body>
</html>
